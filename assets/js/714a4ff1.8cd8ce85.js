"use strict";(self.webpackChunkdp_dokumentasjon=self.webpackChunkdp_dokumentasjon||[]).push([[1185],{6052:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>p,contentTitle:()=>s,default:()=>g,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var t=n(5893),i=n(1151);const o={sidebar_position:1,title:"Backend"},s="dp-rapportering",a={id:"innbyggerflate/losninger/rapportering/backend",title:"Backend",description:"Form\xe5l",source:"@site/docs/innbyggerflate/losninger/rapportering/backend.mdx",sourceDirName:"innbyggerflate/losninger/rapportering",slug:"/innbyggerflate/losninger/rapportering/backend",permalink:"/dp-dokumentasjon/docs/innbyggerflate/losninger/rapportering/backend",draft:!1,unlisted:!1,editUrl:"https://github.com/navikt/dp-dokumentasjon/docs/innbyggerflate/losninger/rapportering/backend.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Backend"},sidebar:"tutorialSidebar",previous:{title:"Rapportering",permalink:"/dp-dokumentasjon/docs/innbyggerflate/losninger/rapportering/"},next:{title:"Frontend",permalink:"/dp-dokumentasjon/docs/innbyggerflate/losninger/rapportering/frontend"}},p={},d=[{value:"Form\xe5l",id:"form\xe5l",level:2},{value:"Teknologier",id:"teknologier",level:2},{value:"App-arkitektur",id:"app-arkitektur",level:2},{value:"API",id:"api",level:3},{value:"Mottak",id:"mottak",level:3},{value:"S\xf8knadMottak",id:"s\xf8knadmottak",level:4},{value:"RapporteringspliktDatoMottak",id:"rapporteringspliktdatomottak",level:4},{value:"VedtakMottak",id:"vedtakmottak",level:4},{value:"RapporteringMellomlagretMottak",id:"rapporteringmellomlagretmottak",level:4},{value:"RapporteringJournalf\xf8rtMottak",id:"rapporteringjournalf\xf8rtmottak",level:4},{value:"Jobber som kj\xf8rer regelmessig",id:"jobber-som-kj\xf8rer-regelmessig",level:3},{value:"InnsendingsJobb",id:"innsendingsjobb",level:4},{value:"NyRapporteringssyklusJobb",id:"nyrapporteringssyklusjobb",level:4},{value:"Domene",id:"domene",level:2},{value:"Rapporteringsplikt",id:"rapporteringsplikt",level:3},{value:"Rapporteringsperiode",id:"rapporteringsperiode",level:3},{value:"Aktivitet",id:"aktivitet",level:3},{value:"Utfordringer",id:"utfordringer",level:2},{value:"Lenker",id:"lenker",level:2}];function l(e){const r={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h1,{id:"dp-rapportering",children:"dp-rapportering"}),"\n",(0,t.jsx)(r.h2,{id:"form\xe5l",children:"Form\xe5l"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Levere endepunkter som gj\xf8r det mulig \xe5 hente, opprette, godkjenne, avgodkjenne og korrigere rapporteringsperioder, samt rapportering og sletting av aktiviteter for en gitt rapporteringsperiode. Endepunktene benyttes av ",(0,t.jsx)(r.a,{href:"https://github.com/navikt/dp-rapportering-frontend",children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"dp-rapportering-frontend"})})})," og ",(0,t.jsx)(r.a,{href:"https://github.com/navikt/dp-saksbehandling-frontend",children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"dp-saksbehandling-frontend"})})})," som eksponerer funksjonalitetene til henholdvis bruker og saksbehandler"]}),"\n",(0,t.jsx)(r.li,{children:"Oppretter rapporteringsplikt for dagpenges\xf8kere og dermed ogs\xe5 rapporteringsperioder"}),"\n",(0,t.jsxs)(r.li,{children:["Sende ut melding om at en rapporteringsperiode er innsendt, denne meldingen h\xe5ndteres av ",(0,t.jsx)(r.a,{href:"https://github.com/navikt/dp-vedtak",children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"dp-vedtak"})})})]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"teknologier",children:"Teknologier"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Kotlin"}),"\n",(0,t.jsx)(r.li,{children:"Gradle"}),"\n",(0,t.jsx)(r.li,{children:"Ktor"}),"\n",(0,t.jsx)(r.li,{children:"Kafka"}),"\n",(0,t.jsx)(r.li,{children:"Postgres"}),"\n",(0,t.jsx)(r.li,{children:"JUnit"}),"\n",(0,t.jsx)(r.li,{children:"OpenAPI"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"app-arkitektur",children:"App-arkitektur"}),"\n",(0,t.jsx)(r.h3,{id:"api",children:"API"}),"\n",(0,t.jsxs)(r.p,{children:["Appen bruker OpenAPI for \xe5 definere og dokumentere API-et. OpenAPI-spesifikasjonen ligger i ",(0,t.jsx)(r.a,{href:"https://github.com/navikt/dp-rapportering/blob/main/openapi/src/main/resources/rapportering-api.yaml",children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"rapportering-api.yaml"})})})," filen og dokumentasjonen kan du finne to steder:"]}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:["\xc5pen versjon p\xe5 GitHub Pages: ",(0,t.jsx)(r.a,{href:"https://navikt.github.io/dp-rapportering/",children:"https://navikt.github.io/dp-rapportering/"})]}),"\n",(0,t.jsxs)(r.li,{children:["Interaktiv versjon som krever naisdevice: ",(0,t.jsx)(r.a,{href:"https://dp-rapportering.intern.dev.nav.no/rapportering",children:"https://dp-rapportering.intern.dev.nav.no/rapportering"})]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"mottak",children:"Mottak"}),"\n",(0,t.jsx)(r.h4,{id:"s\xf8knadmottak",children:"S\xf8knadMottak"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsxs)(r.p,{children:['Behandler "innsending_ferdigstilt" event for type "NyS\xf8knad" som blir sendt fra ',(0,t.jsx)(r.a,{href:"https://github.com/navikt/dp-mottak",children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"dp-mottak"})})}),'. Vi henter eller oppretter Person med s\xf8knadens ident. Person f\xe5r rapporteringsplikt av type "ingen" ved opprettelse. For \xe5 opprette rapporteringsplikt av type "s\xf8knad" for personen trenger vi s\xf8knadstidspunktet. Det blir sendt ut et behov "S\xf8knadstidspunkt" som ',(0,t.jsx)(r.a,{href:"https://github.com/navikt/dp-soknad",children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"dp-soknad"})})})," l\xf8ser."]}),"\n"]}),"\n",(0,t.jsx)(r.h4,{id:"rapporteringspliktdatomottak",children:"RapporteringspliktDatoMottak"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:'Mottar l\xf8sning av behov "S\xf8knadstidspunkt". Det blir n\xe5 opprettet rapporteringsplikt av type "s\xf8knad" for personen fra og med s\xf8knadstidspunktet. Det blir ogs\xe5 opprettet en rapporteringsperiode.'}),"\n"]}),"\n",(0,t.jsx)(r.h4,{id:"vedtakmottak",children:"VedtakMottak"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsxs)(r.p,{children:['Behandler "dagpenger_innvilget" og "dagpenger_avsl\xe5tt" event som blir sendt fra ',(0,t.jsx)(r.a,{href:"https://github.com/navikt/dp-vedtak",children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"dp-vedtak"})})}),'. Ved innvilgelse f\xe5r person rapporteringsplikt av type "vedtak", ved avslag har ikke person lenger rapporteringsplikt og f\xe5r derfor rapporteringsplikt av type "ingen". Fra og med datoen for rapporteringsplikten blir satt til virkningsdatoen til vedtaket.']}),"\n"]}),"\n",(0,t.jsx)(r.h4,{id:"rapporteringmellomlagretmottak",children:"RapporteringMellomlagretMottak"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsxs)(r.p,{children:['N\xe5r bruker godkjenner en rapporteringsperiode blir det sendt ut et behov "MellomlagreRapportering" som ',(0,t.jsx)(r.a,{href:"https://github.com/navikt/dp-behov-soknad-pdf",children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"dp-behov-soknad-pdf"})})})," h\xe5ndterer i ",(0,t.jsx)(r.a,{href:"https://github.com/navikt/dp-behov-soknad-pdf/blob/bc861b3bfa92b68e23943055a587d0a1b4aba9e7/src/main/kotlin/no/nav/dagpenger/innsending/l%C3%B8sere/RapporteringPdfBehovL%C3%B8ser.kt#L34",children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"RapporteringPdfBehovL\xf8ser"})})}),'. RapporteringMellomlagretMottak mottar l\xf8sningen av dette behovet, og det blir n\xe5 sendt ut et behov "Journalf\xf8reRapportering" som ',(0,t.jsx)(r.a,{href:"https://github.com/navikt/dp-behov-journalforing",children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"dp-behov-journalforing"})})})," h\xe5ndterer i ",(0,t.jsx)(r.a,{href:"https://github.com/navikt/dp-behov-journalforing/blob/cea548ce3be1671b0d2ffbbe9860c4f044e1f5f3/src/main/kotlin/no/nav/dagpenger/behov/journalforing/tjenester/RapporteringJournalf%C3%B8ringBehovL%C3%B8ser.kt#L29",children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"RapporteringJournalf\xf8ringBehovL\xf8ser"})})}),"."]}),"\n"]}),"\n",(0,t.jsx)(r.h4,{id:"rapporteringjournalf\xf8rtmottak",children:"RapporteringJournalf\xf8rtMottak"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:'Mottar l\xf8sning av behov "Journalf\xf8reRapportering", per n\xe5 gj\xf8r vi ikke noe annet enn \xe5 logge og registrere i aktivitetsloggen at det er journalf\xf8rt.'}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"jobber-som-kj\xf8rer-regelmessig",children:"Jobber som kj\xf8rer regelmessig"}),"\n",(0,t.jsx)(r.h4,{id:"innsendingsjobb",children:"InnsendingsJobb"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsxs)(r.p,{children:['Rapporteringsperiodene til personer som har f\xe5tt innvilget dagpenger m\xe5 sendes til beregning. Denne jobben kj\xf8rer hvert 15e minutt og finner f\xf8rst alle personer som har gdokjente rapporteringsperioder. Dersom personen har rapporteringsplikt av type "vedtak" finner vi alle rapporteringsperioder som er relevante, det vil si rapporteringsperioder som gjelder for det tidspunktet personen har hatt innvilgelse av dagpenger. Dersom beregningsdatoen for disse rapporteringsperiodene er passert, setter vi tilstanden til "Innsendt" og det blir sendt ut en melding om "rapporteringsperiode_innsendt_hendelse" som ',(0,t.jsx)(r.a,{href:"https://github.com/navikt/dp-vedtak",children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"dp-vedtak"})})})," h\xe5ndterer."]}),"\n"]}),"\n",(0,t.jsx)(r.h4,{id:"nyrapporteringssyklusjobb",children:"NyRapporteringssyklusJobb"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:'Denne jobben kj\xf8rer hver mandag. Den finner alle personer som har rapporteringsplikt av type "s\xf8knad" eller "vedtak" og oppretter en ny rapporteringsperiode for disse.'}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"domene",children:"Domene"}),"\n",(0,t.jsx)(r.h3,{id:"rapporteringsplikt",children:"Rapporteringsplikt"}),"\n",(0,t.jsx)(r.p,{children:"Dagpenges\xf8kere og dagpengemottakere har rapporteringsplikt, dette betyr at de er pliktig til \xe5 rapportere aktiviteter i en gitt periode. Vi skiller mellom tre typer rapporteringsplikt:"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Ingen"}),": Person har ikke rapporteringsplikt"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"S\xf8knad"}),": Person har rapporteringsplikt fordi hen har sendt en s\xf8knad om dagpenger. Rapporteringsplikten starter fra og med s\xf8knadstidspunktet."]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Vedtak"}),": Person har rapporteringsplikt fordi hen har f\xe5tt innvilget dagpenger. Rapporteringsplikten starter fra og med virkningsdatoen til vedtaket."]}),"\n",(0,t.jsx)(r.p,{children:"Flyten for de ulike typene rapporteringsplikt er som f\xf8lger:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:'Person sender en s\xf8knad om dagpenger og blir opprettet i v\xe5re systemer med rapporteringsplikt av type "ingen".'}),"\n",(0,t.jsx)(r.li,{children:'For \xe5 kunne opprette rapporteringsplikt av type "s\xf8knad" trenger vi s\xf8knadstidspunktet, n\xe5r vi har f\xe5tt svar p\xe5 dette behovet oppretter vi rapporteringsplikt av type "s\xf8knad" for personen fra og med s\xf8knadstidspunktet.'}),"\n",(0,t.jsx)(r.li,{children:'Person f\xe5r et vedtak, enten innvilgelse eller avslag. Ved innvilgelse oppretter vi rapporteringsplikt av type "vedtak" fra og med virkningsdatoen til vedtaket. Ved avslag oppretter vi rapporteringsplikt av type "ingen" fra virkningsdatoen til vedtaket.'}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"rapporteringsperiode",children:"Rapporteringsperiode"}),"\n",(0,t.jsx)(r.p,{children:"En rapporteringsperiode er en periode hvor dagpenges\xf8kere med rapporteringsplikt kan rapportere aktiviteter. Alle rapporteringsperioder starter p\xe5 en mandag og varer i 2 uker.\nEn rapporteringsperiode kan v\xe6re i en av f\xf8lgende tilstander:"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"TilUtfylling"}),": Rapporteringsperioden er opprettet og klar til \xe5 fylles ut/er under utfylling."]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Godkjent"}),": Rapporteringsperioden er godkjent av bruker og klar til \xe5 sendes til beregning."]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Innsendt"}),": Rapporteringsperioden er sendt til beregning."]}),"\n",(0,t.jsx)(r.h3,{id:"aktivitet",children:"Aktivitet"}),"\n",(0,t.jsx)(r.p,{children:'Det rapporteres aktiviteter for dagene i en rapporteringsperiode. En aktivitet er enten arbeid, sykdom eller ferie og har en dato og antall timer. En aktivitet kan v\xe6re i tilstand \xe5pen, l\xe5st eller slettet. En aktivitet er \xe5pen frem til bruker godkjenner rapporteringsperioden, da settes tilstanden til l\xe5st. Ved avgodkjenning av en rapporteringsperiode settes alle aktiviteter til \xe5pen igjen. En aktivitet kan bare slettes n\xe5r rapporteringsperioden er i tilstanden "TilUtfylling".'}),"\n",(0,t.jsx)(r.h2,{id:"utfordringer",children:"Utfordringer"}),"\n",(0,t.jsx)(r.p,{children:"TODO: Hvilke utfordringer har denne applikasjonen? F.eks. med hvordan den er strukturert, vanskelig \xe5 oppgradere, utdaterte avhengigheter"}),"\n",(0,t.jsx)(r.h2,{id:"lenker",children:"Lenker"})]})}function g(e={}){const{wrapper:r}={...(0,i.a)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},1151:(e,r,n)=>{n.d(r,{Z:()=>a,a:()=>s});var t=n(7294);const i={},o=t.createContext(i);function s(e){const r=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(o.Provider,{value:r},e.children)}}}]);